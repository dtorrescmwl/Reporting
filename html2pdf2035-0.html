<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>KPI_DEFINITIONS_GUIDE</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#healthcare-kpi-dashboard---complete-definitions-guide">Healthcare KPI Dashboard - Complete Definitions Guide</a><ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#summary-statistics">Summary Statistics</a><ul>
<li><a href="#total-customers">1. Total Customers</a></li>
<li><a href="#active-subscriptions">2. Active Subscriptions</a></li>
<li><a href="#total-orders">3. Total Orders</a></li>
<li><a href="#total-revenue">4. Total Revenue</a></li>
</ul></li>
<li><a href="#snapshot-metrics-time-independent">Snapshot Metrics (Time-Independent)</a><ul>
<li><a href="#active-patients">5. Active Patients</a></li>
<li><a href="#realized-clv-all-customers">6. Realized CLV (All Customers)</a></li>
<li><a href="#realized-clv-mature-customers">7. Realized CLV (Mature Customers)</a></li>
<li><a href="#mature-customer-ratio">8. Mature Customer Ratio</a></li>
<li><a href="#renewal-rate">9. Renewal Rate</a></li>
</ul></li>
<li><a href="#timed-metrics-date-range-sensitive">Timed Metrics (Date Range Sensitive)</a><ul>
<li><a href="#new-patient-enrollments">10. New Patient Enrollments</a></li>
<li><a href="#geographic-reach">11. Geographic Reach</a></li>
<li><a href="#monthly-recurring-revenue-mrr">12. Monthly Recurring Revenue (MRR)</a></li>
<li><a href="#average-revenue-per-user-arpu">13. Average Revenue Per User (ARPU)</a></li>
<li><a href="#net-revenue-after-refunds">14. Net Revenue After Refunds</a></li>
<li><a href="#payment-success-rate">15. Payment Success Rate</a></li>
<li><a href="#churn-rate">16. Churn Rate</a></li>
<li><a href="#predictive-clv">17. Predictive CLV</a></li>
<li><a href="#medication-adherence-rate">18. Medication Adherence Rate</a></li>
<li><a href="#order-processing-efficiency">19. Order Processing Efficiency</a></li>
<li><a href="#product-performance">20. Product Performance</a></li>
</ul></li>
<li><a href="#data-quality-indicators">Data Quality Indicators</a><ul>
<li><a href="#quality-assessment">Quality Assessment</a></li>
<li><a href="#quality-levels-by-metric">Quality Levels by Metric</a></li>
</ul></li>
<li><a href="#time-period-calculations">Time Period Calculations</a><ul>
<li><a href="#date-range-determination">Date Range Determination</a></li>
</ul></li>
<li><a href="#data-sources-reference">Data Sources Reference</a><ul>
<li><a href="#spreadsheet-structure">Spreadsheet Structure</a></li>
<li><a href="#sheet-names-and-key-fields">Sheet Names and Key Fields</a></li>
</ul></li>
<li><a href="#calculation-performance">Calculation Performance</a><ul>
<li><a href="#caching-strategy">Caching Strategy</a></li>
<li><a href="#calculation-order">Calculation Order</a></li>
</ul></li>
<li><a href="#metadata-display">Metadata Display</a></li>
<li><a href="#dashboard-sections">Dashboard Sections</a></li>
<li><a href="#pending-kpis-placeholders">Pending KPIs (Placeholders)</a></li>
<li><a href="#technical-notes">Technical Notes</a><ul>
<li><a href="#google-apps-script-compatibility">Google Apps Script Compatibility</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#browser-compatibility">Browser Compatibility</a></li>
</ul></li>
<li><a href="#version-history">Version History</a></li>
<li><a href="#contact-support">Contact &amp; Support</a></li>
</ul></li>
</ul>
</nav>
<h1 id="healthcare-kpi-dashboard---complete-definitions-guide">Healthcare KPI Dashboard - Complete Definitions Guide</h1>
<p><strong>Document Version:</strong> 1.0 <strong>Last Updated:</strong> 2025-10-22 <strong>Data Source:</strong> Database_CarePortals.xlsx <strong>Dashboard URL:</strong> https://script.google.com/a/macros/cmwlvirtual.com/s/AKfycbw7pUMTMbSMdwnot8NpC8W7H3UzFvjDwl6_Rx03oYyyFubFGYowKmpg_deRtmnDght-5A/exec</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#summary-statistics">Summary Statistics</a></li>
<li><a href="#snapshot-metrics">Snapshot Metrics (Time-Independent)</a></li>
<li><a href="#timed-metrics">Timed Metrics (Date Range Sensitive)</a></li>
<li><a href="#data-quality-indicators">Data Quality Indicators</a></li>
</ol>
<hr />
<h2 id="summary-statistics">Summary Statistics</h2>
<p>These high-level metrics appear at the top of the dashboard and provide quick insights into the business.</p>
<h3 id="total-customers">1. Total Customers</h3>
<p><strong>What it is:</strong> The total number of unique customers in the system.</p>
<p><strong>What it means:</strong> Represents the complete customer base that has ever interacted with the business.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="va">data</span>.<span class="va">customers</span>.<span class="at">length</span></a></code></pre></div>
<p><strong>Data Source:</strong> <code>customers</code> sheet</p>
<p><strong>Quality Indicator:</strong> Good if &gt; 10 customers</p>
<hr />
<h3 id="active-subscriptions">2. Active Subscriptions</h3>
<p><strong>What it is:</strong> The count of currently active subscription records.</p>
<p><strong>What it means:</strong> Indicates the number of subscriptions that are currently generating recurring revenue.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">filter</span>(s <span class="kw">=&gt;</span> <span class="va">s</span>.<span class="at">Status</span> <span class="op">===</span> <span class="st">&#39;active&#39;</span>).<span class="at">length</span></a></code></pre></div>
<p><strong>Data Source:</strong> <code>subscription.active</code> sheet</p>
<p><strong>Filter Criteria:</strong> <code>Status = 'active'</code></p>
<p><strong>Quality Indicator:</strong> Higher is better; indicates healthy recurring revenue base</p>
<hr />
<h3 id="total-orders">3. Total Orders</h3>
<p><strong>What it is:</strong> The cumulative count of all orders ever placed.</p>
<p><strong>What it means:</strong> Represents the total transaction volume across all time.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">data</span>.<span class="va">orders</span>.<span class="at">length</span></a></code></pre></div>
<p><strong>Data Source:</strong> <code>order.created</code> sheet</p>
<p><strong>Quality Indicator:</strong> Good if &gt; 10 orders</p>
<hr />
<h3 id="total-revenue">4. Total Revenue</h3>
<p><strong>What it is:</strong> The sum of all successful payments.</p>
<p><strong>What it means:</strong> Gross revenue generated before refunds.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="va">data</span>.<span class="va">payments</span>.<span class="at">reduce</span>((sum<span class="op">,</span> payment) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="cf">return</span> sum <span class="op">+</span> (<span class="at">parseFloat</span>(<span class="va">payment</span>.<span class="at">amount</span>) <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="op">},</span> <span class="dv">0</span>)</a></code></pre></div>
<p><strong>Data Source:</strong> <code>payment_succesful</code> sheet</p>
<p><strong>Formula:</strong> Sum(payment.amount) for all payments</p>
<p><strong>Display Format:</strong> Currency (USD) with comma separators</p>
<hr />
<h2 id="snapshot-metrics-time-independent">Snapshot Metrics (Time-Independent)</h2>
<p>These metrics represent the current state of the business and are not filtered by date range.</p>
<h3 id="active-patients">5. Active Patients</h3>
<p><strong>Section:</strong> Clinical &amp; Patient Success</p>
<p><strong>What it is:</strong> Count of subscriptions with active status.</p>
<p><strong>What it means:</strong> Number of patients currently enrolled in treatment programs.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">filter</span>(s <span class="kw">=&gt;</span> <span class="va">s</span>.<span class="at">Status</span> <span class="op">===</span> <span class="st">&#39;active&#39;</span>).<span class="at">length</span></a></code></pre></div>
<p><strong>Data Source:</strong> <code>subscription.active</code> sheet</p>
<p><strong>Filter:</strong> <code>Status = 'active'</code></p>
<p><strong>Quality Indicator:</strong> ‘good’ quality</p>
<p><strong>Clinical Significance:</strong> Represents active patient census</p>
<hr />
<h3 id="realized-clv-all-customers">6. Realized CLV (All Customers)</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Average total revenue generated per customer across all customers.</p>
<p><strong>What it means:</strong> Historical customer value based on actual transactions, not predictions.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// Step 1: Group orders by customer and sum revenue</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">const</span> customers <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="va">data</span>.<span class="va">orders</span>.<span class="at">forEach</span>(order <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="kw">const</span> customerId <span class="op">=</span> <span class="va">order</span>.<span class="at">customer_id</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="cf">if</span> (<span class="op">!</span>customerId) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="kw">const</span> amount <span class="op">=</span> <span class="at">parseFloat</span>(<span class="va">order</span>.<span class="at">total_amount</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="cf">if</span> (<span class="op">!</span>customers[customerId]) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">    customers[customerId] <span class="op">=</span> <span class="op">{</span> <span class="dt">totalRevenue</span><span class="op">:</span> <span class="dv">0</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-11" title="11">  customers[customerId].<span class="at">totalRevenue</span> <span class="op">+=</span> amount<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-13" title="13"></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">// Step 2: Calculate average</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="kw">let</span> totalRevenue <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="kw">let</span> customerCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="va">Object</span>.<span class="at">keys</span>(customers).<span class="at">forEach</span>(customerId <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-19" title="19">  totalRevenue <span class="op">+=</span> customers[customerId].<span class="at">totalRevenue</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-20" title="20">  customerCount<span class="op">++;</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-22" title="22"></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="kw">const</span> realizedCLV_all <span class="op">=</span> customerCount <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> totalRevenue / customerCount : <span class="dv">0</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>Sum(order.total_amount per customer) / Total Customers</code></p>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (order.total_amount, customer_id)</p>
<p><strong>Methodology:</strong> Sum of all order amounts per customer, averaged across all customers</p>
<p><strong>Quality Indicator:</strong> ‘good’ quality when sufficient data exists</p>
<p><strong>Business Significance:</strong> Shows actual revenue per customer relationship</p>
<hr />
<h3 id="realized-clv-mature-customers">7. Realized CLV (Mature Customers)</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Average total revenue per customer who has completed their initial prepaid period or cancelled.</p>
<p><strong>What it means:</strong> More accurate CLV metric focusing only on customers who have had time to demonstrate their full lifecycle value.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// Determine mature customers</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">// A customer is &quot;mature&quot; if:</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">// 1. They have cancelled (in subscription.cancelled sheet), OR</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">// 2. Number of orders &gt; sale_cycle_duration, OR</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">// 3. Number of orders = sale_cycle_duration AND 1+ months since last order</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw">const</span> isMature <span class="op">=</span> (customerId<span class="op">,</span> numOrders<span class="op">,</span> lastOrderDate<span class="op">,</span> productId) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="kw">const</span> hasCancelled <span class="op">=</span> <span class="va">data</span>.<span class="va">cancelledSubs</span>.<span class="at">some</span>(sub <span class="kw">=&gt;</span> <span class="va">sub</span>.<span class="at">customer_id</span> <span class="op">===</span> customerId)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="kw">const</span> hasPaused <span class="op">=</span> <span class="va">data</span>.<span class="va">pausedSubs</span>.<span class="at">some</span>(sub <span class="kw">=&gt;</span> <span class="va">sub</span>.<span class="at">customer_id</span> <span class="op">===</span> customerId)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="kw">const</span> duration <span class="op">=</span> productDuration[productId] <span class="op">||</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// from product.sale_cycle_duration</span></a>
<a class="sourceLine" id="cb7-12" title="12">  <span class="kw">const</span> monthsSinceLast <span class="op">=</span> (today <span class="op">-</span> lastOrderDate) / (<span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">30</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="cf">if</span> (hasCancelled) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-15" title="15">  <span class="cf">if</span> (hasPaused) <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="cf">if</span> (numOrders <span class="op">&gt;</span> duration) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-17" title="17">  <span class="cf">if</span> (numOrders <span class="op">===</span> duration <span class="op">&amp;&amp;</span> monthsSinceLast <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19">  <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="op">};</span></a>
<a class="sourceLine" id="cb7-21" title="21"></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">// Calculate CLV for mature customers only</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="kw">let</span> totalMature <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="kw">let</span> countMature <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-25" title="25"></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="va">Object</span>.<span class="at">keys</span>(customers).<span class="at">forEach</span>(customerId <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-27" title="27">  <span class="cf">if</span> (<span class="at">isMature</span>(customerId<span class="op">,</span> ...)) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-28" title="28">    totalMature <span class="op">+=</span> customers[customerId].<span class="at">totalRevenue</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-29" title="29">    countMature<span class="op">++;</span></a>
<a class="sourceLine" id="cb7-30" title="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-32" title="32"></a>
<a class="sourceLine" id="cb7-33" title="33"><span class="kw">const</span> realizedCLV_mature <span class="op">=</span> countMature <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> totalMature / countMature : <span class="dv">0</span><span class="op">;</span></a></code></pre></div>
<p><strong>Maturity Criteria:</strong> 1. Customer has cancelled subscription, OR 2. Customer has paused subscription = FALSE, AND 3. Number of orders &gt; sale_cycle_duration (prepaid period), OR 4. Number of orders = sale_cycle_duration AND 1+ months since last order</p>
<p><strong>Formula:</strong> <code>Sum(order.total_amount for mature customers) / Count(mature customers)</code></p>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (total_amount, customer_id, created_at) - <code>subscription.cancelled</code> sheet (customer_id) - <code>subscription.paused</code> sheet (customer_id) - <code>products</code> sheet (sale_cycle_duration)</p>
<p><strong>Quality Indicator:</strong> ‘good’ quality when sufficient mature customers exist</p>
<p><strong>Business Significance:</strong> More accurate predictor of long-term customer value than all-customer CLV</p>
<hr />
<h3 id="mature-customer-ratio">8. Mature Customer Ratio</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Percentage of customers who have reached maturity status.</p>
<p><strong>What it means:</strong> Indicates how much of the customer base has been around long enough to demonstrate full lifecycle behavior.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> matureCustomerRatio <span class="op">=</span> (countMature / countAll) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>(Mature Customers / Total Customers) * 100</code></p>
<p><strong>Display:</strong> Percentage with 2 decimal places</p>
<p><strong>Breakdown Displayed:</strong> - Count of mature customers - Total customer count</p>
<p><strong>Data Sources:</strong> Same as Realized CLV calculations</p>
<p><strong>Quality Indicator:</strong> ‘good’ quality when data is complete</p>
<p><strong>Business Significance:</strong> Higher ratio means more reliable CLV projections</p>
<hr />
<h3 id="renewal-rate">9. Renewal Rate</h3>
<p><strong>Section:</strong> Clinical &amp; Patient Success</p>
<p><strong>What it is:</strong> Percentage of mature customers who placed at least one paid renewal order after their prepaid period.</p>
<p><strong>What it means:</strong> Measures customer retention and satisfaction after the initial commitment period ends.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">// Step 1: Identify mature customers (same logic as CLV)</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">// Step 2: For each mature customer, check if they have renewal orders</span></a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">const</span> hasRenewalOrder <span class="op">=</span> (customerId<span class="op">,</span> productId) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="kw">const</span> duration <span class="op">=</span> productDuration[productId] <span class="op">||</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// from product.sale_cycle_duration</span></a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="kw">const</span> orders <span class="op">=</span> customers[customerId].<span class="va">orders</span>.<span class="at">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="va">a</span>.<span class="at">date</span> <span class="op">-</span> <span class="va">b</span>.<span class="at">date</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="kw">const</span> prepaidOrders <span class="op">=</span> <span class="va">orders</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> duration)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="kw">const</span> renewalOrders <span class="op">=</span> <span class="va">orders</span>.<span class="at">slice</span>(duration)<span class="op">;</span> <span class="co">// Orders after prepaid period</span></a>
<a class="sourceLine" id="cb9-10" title="10"></a>
<a class="sourceLine" id="cb9-11" title="11">  <span class="co">// Check if any renewal order has amount &gt; 0</span></a>
<a class="sourceLine" id="cb9-12" title="12">  <span class="cf">return</span> <span class="va">renewalOrders</span>.<span class="at">some</span>(order <span class="kw">=&gt;</span> <span class="va">order</span>.<span class="at">amount</span> <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="op">};</span></a>
<a class="sourceLine" id="cb9-14" title="14"></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="kw">let</span> renewedCustomers <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="va">matureCustomers</span>.<span class="at">forEach</span>(customerId <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-17" title="17">  <span class="cf">if</span> (<span class="at">hasRenewalOrder</span>(customerId<span class="op">,</span> productId)) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-18" title="18">    renewedCustomers<span class="op">++;</span></a>
<a class="sourceLine" id="cb9-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-21" title="21"></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="kw">const</span> renewalRate <span class="op">=</span> (renewedCustomers / matureCustomers) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>(Renewed Customers / Mature Customers) * 100</code></p>
<p><strong>Renewed Customer Definition:</strong> A mature customer who has at least one paid order (amount &gt; 0) after their prepaid period</p>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (customer_id, total_amount, created_at, product_id) - <code>products</code> sheet (sale_cycle_duration) - <code>subscription.cancelled</code> sheet - <code>subscription.paused</code> sheet</p>
<p><strong>Display:</strong> Percentage with 2 decimal places, plus counts</p>
<p><strong>Quality Thresholds:</strong> - Excellent: ≥ 80% - Good: 60-79% - Needs Improvement: 40-59% - Low: &lt; 40%</p>
<p><strong>Business Significance:</strong> Critical retention metric; higher renewal rates indicate product-market fit and customer satisfaction</p>
<hr />
<h2 id="timed-metrics-date-range-sensitive">Timed Metrics (Date Range Sensitive)</h2>
<p>These metrics are calculated based on the selected time period (daily, weekly, monthly, quarterly, annually, all-time, or custom range).</p>
<h3 id="new-patient-enrollments">10. New Patient Enrollments</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Count of unique customers whose first checkout order occurred in the selected date range.</p>
<p><strong>What it means:</strong> New customer acquisition for the period.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// Step 1: Find first checkout order for each customer</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">const</span> customerFirstOrders <span class="op">=</span> <span class="kw">new</span> <span class="at">Map</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">const</span> checkoutOrders <span class="op">=</span> <span class="va">data</span>.<span class="va">orders</span>.<span class="at">filter</span>(order <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="va">order</span>.<span class="at">source</span> <span class="op">===</span> <span class="st">&#39;checkout&#39;</span> <span class="op">&amp;&amp;</span> <span class="va">order</span>.<span class="at">created_at</span> <span class="op">&amp;&amp;</span> <span class="va">order</span>.<span class="at">customer_id</span></a>
<a class="sourceLine" id="cb10-6" title="6">)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="va">checkoutOrders</span>.<span class="at">forEach</span>(order <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-9" title="9">  <span class="kw">const</span> customerId <span class="op">=</span> <span class="va">order</span>.<span class="at">customer_id</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="kw">const</span> orderDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">order</span>.<span class="at">created_at</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12">  <span class="cf">if</span> (<span class="op">!</span><span class="va">customerFirstOrders</span>.<span class="at">has</span>(customerId)) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-13" title="13">    <span class="va">customerFirstOrders</span>.<span class="at">set</span>(customerId<span class="op">,</span> orderDate)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-14" title="14">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-15" title="15">    <span class="co">// Keep earliest order</span></a>
<a class="sourceLine" id="cb10-16" title="16">    <span class="kw">const</span> existingDate <span class="op">=</span> <span class="va">customerFirstOrders</span>.<span class="at">get</span>(customerId)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-17" title="17">    <span class="cf">if</span> (orderDate <span class="op">&lt;</span> existingDate) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-18" title="18">      <span class="va">customerFirstOrders</span>.<span class="at">set</span>(customerId<span class="op">,</span> orderDate)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-19" title="19">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-22" title="22"></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">// Step 2: Count customers with first order in date range</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="kw">let</span> newPatientCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="va">customerFirstOrders</span>.<span class="at">forEach</span>((firstOrderDate<span class="op">,</span> customerId) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-26" title="26">  <span class="cf">if</span> (firstOrderDate <span class="op">&gt;=</span> startDate <span class="op">&amp;&amp;</span> firstOrderDate <span class="op">&lt;=</span> endDate) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-27" title="27">    newPatientCount<span class="op">++;</span></a>
<a class="sourceLine" id="cb10-28" title="28">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Filter Criteria:</strong> - <code>order.source = 'checkout'</code> (excludes renewal orders) - First order by customer - Order date within selected range</p>
<p><strong>Formula:</strong> <code>Count(DISTINCT customer_id WHERE first_checkout_order.created_at BETWEEN startDate AND endDate)</code></p>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (customer_id, created_at, source)</p>
<p><strong>Quality Indicator:</strong> - Good: &gt; 0 new patients - Low: 0 new patients</p>
<p><strong>Business Significance:</strong> Primary growth indicator; tracks acquisition performance</p>
<hr />
<h3 id="geographic-reach">11. Geographic Reach</h3>
<p><strong>Section:</strong> Operations &amp; Logistics Metrics</p>
<p><strong>What it is:</strong> Number of unique US states with orders in the selected date range.</p>
<p><strong>What it means:</strong> Market penetration and geographic distribution of the customer base.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">const</span> activeStates <span class="op">=</span> <span class="kw">new</span> <span class="at">Set</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="va">data</span>.<span class="va">orders</span>.<span class="at">forEach</span>(order <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="cf">if</span> (<span class="op">!</span><span class="va">order</span>.<span class="at">shipping_address_id</span> <span class="op">||</span> <span class="op">!</span><span class="va">order</span>.<span class="at">created_at</span>) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">const</span> orderDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">order</span>.<span class="at">created_at</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="cf">if</span> (orderDate <span class="op">&lt;</span> startDate <span class="op">||</span> orderDate <span class="op">&gt;</span> endDate) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9">  <span class="co">// Find address</span></a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="kw">const</span> address <span class="op">=</span> <span class="va">data</span>.<span class="va">addresses</span>.<span class="at">find</span>(addr <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb11-11" title="11">    <span class="va">addr</span>.<span class="at">address_id</span> <span class="op">===</span> <span class="va">order</span>.<span class="at">shipping_address_id</span></a>
<a class="sourceLine" id="cb11-12" title="12">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14">  <span class="cf">if</span> (address <span class="op">&amp;&amp;</span> <span class="va">address</span>.<span class="at">province_code</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-15" title="15">    <span class="va">activeStates</span>.<span class="at">add</span>(<span class="va">address</span>.<span class="at">province_code</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-16" title="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-18" title="18"></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="kw">const</span> stateCount <span class="op">=</span> <span class="va">activeStates</span>.<span class="at">size</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>COUNT(DISTINCT address.province_code WHERE order.created_at BETWEEN startDate AND endDate)</code></p>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (shipping_address_id, created_at) - <code>addresses</code> sheet (address_id, province_code)</p>
<p><strong>Join Condition:</strong> <code>order.shipping_address_id = address.address_id</code></p>
<p><strong>Display:</strong> Count of states + list of state codes</p>
<p><strong>Quality Indicator:</strong> - Good: &gt; 0 states - Low: 0 states</p>
<p><strong>Business Significance:</strong> Indicates market expansion and regulatory compliance scope</p>
<hr />
<h3 id="monthly-recurring-revenue-mrr">12. Monthly Recurring Revenue (MRR)</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Normalized monthly revenue from all active subscriptions.</p>
<p><strong>What it means:</strong> Predictable recurring revenue stream; key metric for subscription businesses.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">let</span> totalMRR <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">forEach</span>(sub <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="cf">if</span> (<span class="va">sub</span>.<span class="at">Status</span> <span class="op">!==</span> <span class="st">&#39;active&#39;</span>) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="co">// Find product pricing</span></a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="kw">const</span> product <span class="op">=</span> <span class="va">data</span>.<span class="va">products</span>.<span class="at">find</span>(p <span class="kw">=&gt;</span> <span class="va">p</span>.<span class="at">product_id</span> <span class="op">===</span> <span class="va">sub</span>.<span class="at">ProductID</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="cf">if</span> (<span class="op">!</span>product <span class="op">||</span> <span class="op">!</span><span class="va">product</span>.<span class="at">renewal_price</span>) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-9" title="9"></a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="kw">const</span> renewalPrice <span class="op">=</span> <span class="at">parseFloat</span>(<span class="va">product</span>.<span class="at">renewal_price</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-11" title="11">  <span class="kw">const</span> cycleDuration <span class="op">=</span> <span class="at">parseInt</span>(<span class="va">product</span>.<span class="at">renewal_cycle_duration</span>) <span class="op">||</span> <span class="dv">30</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-12" title="12"></a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="co">// Normalize to monthly (30 days)</span></a>
<a class="sourceLine" id="cb12-14" title="14">  <span class="kw">const</span> monthlyRevenue <span class="op">=</span> renewalPrice <span class="op">*</span> (<span class="dv">30</span> / cycleDuration)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-15" title="15">  totalMRR <span class="op">+=</span> monthlyRevenue<span class="op">;</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>Sum((product.renewal_price * 30) / product.renewal_cycle_duration) FOR active subscriptions</code></p>
<p><strong>Normalization:</strong> All renewal cycles converted to 30-day months</p>
<p><strong>Data Sources:</strong> - <code>subscription.active</code> sheet (Status, ProductID) - <code>products</code> sheet (product_id, renewal_price, renewal_cycle_duration)</p>
<p><strong>Filter:</strong> Only active subscriptions</p>
<p><strong>Display:</strong> Currency (USD) with 2 decimal places</p>
<p><strong>Breakdown Shown:</strong> - Total MRR amount - Active subscription count</p>
<p><strong>Quality Indicator:</strong> ‘good’ when active subscriptions exist</p>
<p><strong>Business Significance:</strong> Core SaaS metric; indicates recurring revenue health</p>
<hr />
<h3 id="average-revenue-per-user-arpu">13. Average Revenue Per User (ARPU)</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Average monthly revenue generated per customer.</p>
<p><strong>What it means:</strong> Revenue efficiency metric; shows how much each customer contributes monthly.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="co">// Calculated as part of CLV metrics</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">const</span> customers <span class="op">=</span> <span class="op">{};</span> <span class="co">// Group by customer</span></a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="va">data</span>.<span class="va">orders</span>.<span class="at">forEach</span>(order <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="kw">const</span> customerId <span class="op">=</span> <span class="va">order</span>.<span class="at">customer_id</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="cf">if</span> (<span class="op">!</span>customerId <span class="op">||</span> <span class="op">!</span><span class="va">order</span>.<span class="at">created_at</span>) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="kw">const</span> orderDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">order</span>.<span class="at">created_at</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-9" title="9">  <span class="kw">const</span> amount <span class="op">=</span> <span class="at">parseFloat</span>(<span class="va">order</span>.<span class="at">total_amount</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="cf">if</span> (<span class="op">!</span>customers[customerId]) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-12" title="12">    customers[customerId] <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-13" title="13">      <span class="dt">totalRevenue</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-14" title="14">      <span class="dt">orderDates</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="op">};</span></a>
<a class="sourceLine" id="cb13-16" title="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-17" title="17"></a>
<a class="sourceLine" id="cb13-18" title="18">  customers[customerId].<span class="at">totalRevenue</span> <span class="op">+=</span> amount<span class="op">;</span></a>
<a class="sourceLine" id="cb13-19" title="19">  customers[customerId].<span class="va">orderDates</span>.<span class="at">push</span>(orderDate)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-21" title="21"></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="co">// Calculate monthly ARPU per customer</span></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="kw">let</span> arpuSum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="kw">let</span> customerCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-25" title="25"></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="va">Object</span>.<span class="at">keys</span>(customers).<span class="at">forEach</span>(customerId <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-27" title="27">  <span class="kw">const</span> customer <span class="op">=</span> customers[customerId]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-28" title="28">  <span class="kw">const</span> sortedDates <span class="op">=</span> <span class="va">customer</span>.<span class="va">orderDates</span>.<span class="at">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a <span class="op">-</span> b)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-29" title="29">  <span class="kw">const</span> firstOrderDate <span class="op">=</span> sortedDates[<span class="dv">0</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-30" title="30">  <span class="kw">const</span> lastOrderDate <span class="op">=</span> sortedDates[<span class="va">sortedDates</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-31" title="31"></a>
<a class="sourceLine" id="cb13-32" title="32">  <span class="co">// Calculate months active</span></a>
<a class="sourceLine" id="cb13-33" title="33">  <span class="kw">const</span> monthsActive <span class="op">=</span> <span class="va">Math</span>.<span class="at">max</span>(<span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-34" title="34">    <span class="va">Math</span>.<span class="at">ceil</span>((lastOrderDate <span class="op">-</span> firstOrderDate) / (<span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb13-35" title="35">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb13-36" title="36"></a>
<a class="sourceLine" id="cb13-37" title="37">  <span class="co">// Monthly revenue for this customer</span></a>
<a class="sourceLine" id="cb13-38" title="38">  <span class="kw">const</span> monthlyRevenue <span class="op">=</span> <span class="va">customer</span>.<span class="at">totalRevenue</span> / monthsActive<span class="op">;</span></a>
<a class="sourceLine" id="cb13-39" title="39">  arpuSum <span class="op">+=</span> monthlyRevenue<span class="op">;</span></a>
<a class="sourceLine" id="cb13-40" title="40">  customerCount<span class="op">++;</span></a>
<a class="sourceLine" id="cb13-41" title="41"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-42" title="42"></a>
<a class="sourceLine" id="cb13-43" title="43"><span class="kw">const</span> arpu <span class="op">=</span> customerCount <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> arpuSum / customerCount : <span class="dv">0</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>Average(customer.totalRevenue / customer.monthsActive) across all customers</code></p>
<p><strong>Months Active Calculation:</strong></p>
<pre><code>CEILING((lastOrderDate - firstOrderDate) / 30 days)
Minimum: 1 month</code></pre>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (customer_id, total_amount, created_at)</p>
<p><strong>Display:</strong> Currency (USD) with 2 decimal places</p>
<p><strong>Quality Indicator:</strong> ‘good’ when sufficient data exists</p>
<p><strong>Business Significance:</strong> Used in Predictive CLV calculation; indicates per-customer revenue potential</p>
<hr />
<h3 id="net-revenue-after-refunds">14. Net Revenue After Refunds</h3>
<p><strong>Section:</strong> Financial Risk Metrics</p>
<p><strong>What it is:</strong> Total revenue minus total refunds.</p>
<p><strong>What it means:</strong> Actual realized revenue after accounting for returns and cancellations.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="co">// Sum all payments</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">const</span> totalPayments <span class="op">=</span> <span class="va">data</span>.<span class="va">payments</span>.<span class="at">reduce</span>((sum<span class="op">,</span> payment) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="cf">return</span> sum <span class="op">+</span> (<span class="at">parseFloat</span>(<span class="va">payment</span>.<span class="at">amount</span>) <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="op">},</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">// Sum all refunds</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="kw">const</span> totalRefunds <span class="op">=</span> <span class="va">data</span>.<span class="va">refunds</span>.<span class="at">reduce</span>((sum<span class="op">,</span> refund) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-8" title="8">  <span class="cf">return</span> sum <span class="op">+</span> (<span class="at">parseFloat</span>(<span class="va">refund</span>.<span class="at">amount</span>) <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="op">},</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-10" title="10"></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">// Calculate net</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="kw">const</span> netRevenue <span class="op">=</span> totalPayments <span class="op">-</span> totalRefunds<span class="op">;</span></a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">// Calculate refund rate</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="kw">const</span> refundRate <span class="op">=</span> totalPayments <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (totalRefunds / totalPayments) <span class="op">*</span> <span class="dv">100</span> : <span class="dv">0</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>Sum(payment.amount) - Sum(refund.amount)</code></p>
<p><strong>Refund Rate Formula:</strong> <code>(Total Refunds / Total Payments) * 100</code></p>
<p><strong>Data Sources:</strong> - <code>payment_succesful</code> sheet (amount) - <code>refund.created</code> sheet (amount)</p>
<p><strong>Display Components:</strong> - Net Revenue (USD) - Total Payments (USD) - Total Refunds (USD) - Refund Rate (%)</p>
<p><strong>Quality Indicator:</strong> ‘good’ when data complete</p>
<p><strong>Business Significance:</strong> True revenue metric; high refund rates indicate product or service issues</p>
<hr />
<h3 id="payment-success-rate">15. Payment Success Rate</h3>
<p><strong>Section:</strong> Financial Risk Metrics</p>
<p><strong>What it is:</strong> Percentage of payment attempts that succeeded.</p>
<p><strong>What it means:</strong> Payment processing reliability and customer payment method health.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">const</span> totalPayments <span class="op">=</span> <span class="va">data</span>.<span class="va">payments</span>.<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">const</span> successfulPayments <span class="op">=</span> <span class="va">data</span>.<span class="va">payments</span>.<span class="at">filter</span>(p <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="va">p</span>.<span class="at">amount</span> <span class="op">&amp;&amp;</span> <span class="at">parseFloat</span>(<span class="va">p</span>.<span class="at">amount</span>) <span class="op">&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb16-5" title="5">).<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-6" title="6"></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw">const</span> successRate <span class="op">=</span> totalPayments <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span></a>
<a class="sourceLine" id="cb16-8" title="8">  (successfulPayments / totalPayments) <span class="op">*</span> <span class="dv">100</span> : <span class="dv">0</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>(Successful Payments / Total Payment Attempts) * 100</code></p>
<p><strong>Successful Payment Criteria:</strong> <code>payment.amount &gt; 0</code></p>
<p><strong>Data Sources:</strong> - <code>payment_succesful</code> sheet (amount)</p>
<p><strong>Display:</strong> Percentage with 2 decimal places + counts</p>
<p><strong>Quality Thresholds:</strong> - Excellent: &gt; 95% - Good: 90-95% - Needs Improvement: &lt; 90%</p>
<p><strong>Business Significance:</strong> Indicates payment infrastructure health; low rates suggest need for payment method updates or processor issues</p>
<hr />
<h3 id="churn-rate">16. Churn Rate</h3>
<p><strong>Section:</strong> Clinical &amp; Patient Success</p>
<p><strong>What it is:</strong> Percentage of subscriptions that were cancelled per month (based on last 90 days).</p>
<p><strong>What it means:</strong> Customer attrition rate; inverse of retention.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">const</span> ninetyDaysAgo <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">today</span>.<span class="at">getTime</span>() <span class="op">-</span> (<span class="dv">90</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">// Count active subscriptions</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="kw">const</span> activeSubscriptionCount <span class="op">=</span> <span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">filter</span>(s <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="va">s</span>.<span class="at">Status</span> <span class="op">===</span> <span class="st">&#39;active&#39;</span></a>
<a class="sourceLine" id="cb17-6" title="6">).<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">// Count cancellations in last 90 days</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="kw">const</span> cancelledInLast90 <span class="op">=</span> <span class="va">data</span>.<span class="va">cancelledSubs</span>.<span class="at">filter</span>(sub <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-10" title="10">  <span class="cf">if</span> (<span class="op">!</span><span class="va">sub</span>.<span class="at">last_updated</span>) <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-11" title="11">  <span class="kw">const</span> updateDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">sub</span>.<span class="at">last_updated</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-12" title="12">  <span class="cf">return</span> updateDate <span class="op">&gt;=</span> ninetyDaysAgo<span class="op">;</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="op">}</span>).<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-14" title="14"></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="co">// Total subscriptions</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="kw">const</span> totalSubscriptions <span class="op">=</span> activeSubscriptionCount <span class="op">+</span> <span class="va">data</span>.<span class="va">cancelledSubs</span>.<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co">// Calculate monthly churn rate</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="kw">let</span> churnRate <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="cf">if</span> (totalSubscriptions <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-21" title="21">  <span class="cf">if</span> (cancelledInLast90 <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-22" title="22">    <span class="co">// Monthly rate from 90-day period</span></a>
<a class="sourceLine" id="cb17-23" title="23">    churnRate <span class="op">=</span> (cancelledInLast90 / totalSubscriptions) <span class="op">*</span> (<span class="dv">30</span> / <span class="dv">90</span>) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-24" title="24">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-25" title="25">    <span class="co">// Fallback to all-time rate</span></a>
<a class="sourceLine" id="cb17-26" title="26">    churnRate <span class="op">=</span> (<span class="va">data</span>.<span class="va">cancelledSubs</span>.<span class="at">length</span> / totalSubscriptions) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb17-28" title="28"><span class="op">}</span></a></code></pre></div>
<p><strong>Formula (90-day):</strong> <code>(Cancellations in last 90 days / Total Subscriptions) * (30 / 90) * 100</code></p>
<p><strong>Formula (Fallback):</strong> <code>(All Cancellations / Total Subscriptions) * 100</code></p>
<p><strong>90-Day Period:</strong> Used for more current churn rate estimate</p>
<p><strong>Data Sources:</strong> - <code>subscription.active</code> sheet (Status) - <code>subscription.cancelled</code> sheet (customer_id, last_updated)</p>
<p><strong>Display Components:</strong> - Churn rate (%) - Active customer count - Cancelled customer count (90 days) - Methodology description</p>
<p><strong>Quality Thresholds:</strong> - Excellent: &lt; 5% - Good: 5-10% - Needs Improvement: &gt; 10%</p>
<p><strong>Business Significance:</strong> Critical retention metric; directly impacts CLV and long-term growth</p>
<hr />
<h3 id="predictive-clv">17. Predictive CLV</h3>
<p><strong>Section:</strong> Growth &amp; Revenue Metrics</p>
<p><strong>What it is:</strong> Estimated total future lifetime value per customer.</p>
<p><strong>What it means:</strong> Projected total revenue from an average customer over their entire lifecycle.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="co">// Uses ARPU and Churn Rate calculated above</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">const</span> predictiveCLV <span class="op">=</span> churnRate <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (arpu / (churnRate / <span class="dv">100</span>)) : <span class="kw">null</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>ARPU / (Churn Rate / 100)</code></p>
<p><strong>Example:</strong> - If ARPU = $200/month - If Churn Rate = 5% per month (0.05) - Then Predictive CLV = $200 / 0.05 = $4,000</p>
<p><strong>Prerequisites:</strong> - ARPU must be calculated - Churn Rate must be &gt; 0</p>
<p><strong>Data Sources:</strong> Derived from ARPU and Churn Rate calculations</p>
<p><strong>Display:</strong> Currency (USD) with 2 decimal places, plus formula breakdown</p>
<p><strong>Quality Indicator:</strong> ‘good’ when both ARPU and Churn Rate are valid</p>
<p><strong>Business Significance:</strong> Strategic metric for customer acquisition spend; indicates maximum acceptable CAC (Customer Acquisition Cost)</p>
<p><strong>Note:</strong> Returns null if churn rate is 0 (division by zero)</p>
<hr />
<h3 id="medication-adherence-rate">18. Medication Adherence Rate</h3>
<p><strong>Section:</strong> Clinical &amp; Patient Success</p>
<p><strong>What it is:</strong> Percentage of customers enrolled for 90+ days who remain active.</p>
<p><strong>What it means:</strong> Clinical success metric; measures patient compliance with treatment.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">let</span> adherentCustomers <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">let</span> totalEligibleCustomers <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-4" title="4"></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">forEach</span>(sub <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb19-6" title="6">  <span class="cf">if</span> (<span class="op">!</span>sub[<span class="st">&#39;Datetime Created&#39;</span>]) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-7" title="7"></a>
<a class="sourceLine" id="cb19-8" title="8">  <span class="kw">const</span> startDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(sub[<span class="st">&#39;Datetime Created&#39;</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb19-9" title="9">  <span class="kw">const</span> daysSinceStart <span class="op">=</span> (now <span class="op">-</span> startDate) / (<span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-10" title="10"></a>
<a class="sourceLine" id="cb19-11" title="11">  <span class="co">// Only count subscriptions active for 90+ days</span></a>
<a class="sourceLine" id="cb19-12" title="12">  <span class="cf">if</span> (daysSinceStart <span class="op">&gt;=</span> <span class="dv">90</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-13" title="13">    totalEligibleCustomers<span class="op">++;</span></a>
<a class="sourceLine" id="cb19-14" title="14"></a>
<a class="sourceLine" id="cb19-15" title="15">    <span class="co">// Adherent if still active OR completed 90+ days</span></a>
<a class="sourceLine" id="cb19-16" title="16">    <span class="cf">if</span> (<span class="va">sub</span>.<span class="at">Status</span> <span class="op">===</span> <span class="st">&#39;active&#39;</span> <span class="op">||</span> daysSinceStart <span class="op">&gt;=</span> <span class="dv">90</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-17" title="17">      adherentCustomers<span class="op">++;</span></a>
<a class="sourceLine" id="cb19-18" title="18">    <span class="op">}</span></a>
<a class="sourceLine" id="cb19-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb19-20" title="20"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-21" title="21"></a>
<a class="sourceLine" id="cb19-22" title="22"><span class="kw">const</span> adherenceRate <span class="op">=</span> totalEligibleCustomers <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span></a>
<a class="sourceLine" id="cb19-23" title="23">  (adherentCustomers / totalEligibleCustomers) <span class="op">*</span> <span class="dv">100</span> : <span class="dv">0</span><span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>(Adherent Customers / Eligible Customers) * 100</code></p>
<p><strong>Eligible Customer:</strong> Subscription created 90+ days ago</p>
<p><strong>Adherent Customer:</strong> Active status OR completed 90+ days of treatment</p>
<p><strong>Clinical Target:</strong> 80% (industry standard)</p>
<p><strong>Data Sources:</strong> - <code>subscription.active</code> sheet (Datetime Created, Status)</p>
<p><strong>Display Components:</strong> - Adherence rate (%) - Adherent customer count - Total eligible customer count - Clinical target (80%)</p>
<p><strong>Quality Thresholds:</strong> - Excellent: ≥ 80% - Good: 70-79% - Needs Improvement: &lt; 70%</p>
<p><strong>Business Significance:</strong> Clinical effectiveness indicator; correlates with outcomes and retention</p>
<hr />
<h3 id="order-processing-efficiency">19. Order Processing Efficiency</h3>
<p><strong>Section:</strong> Operations &amp; Logistics Metrics</p>
<p><strong>What it is:</strong> Time between order creation and update (processing time).</p>
<p><strong>What it means:</strong> Operational speed; how quickly orders move through the system.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">const</span> processingTimes <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb20-2" title="2"></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="va">data</span>.<span class="va">orders</span>.<span class="at">forEach</span>(order <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="cf">if</span> (<span class="op">!</span><span class="va">order</span>.<span class="at">created_at</span> <span class="op">||</span> <span class="op">!</span><span class="va">order</span>.<span class="at">updated_at</span>) <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-5" title="5"></a>
<a class="sourceLine" id="cb20-6" title="6">  <span class="kw">const</span> createdTime <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">order</span>.<span class="at">created_at</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="kw">const</span> updatedTime <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">order</span>.<span class="at">updated_at</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-8" title="8"></a>
<a class="sourceLine" id="cb20-9" title="9">  <span class="kw">const</span> processingHours <span class="op">=</span> (updatedTime <span class="op">-</span> createdTime) / (<span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-10" title="10"></a>
<a class="sourceLine" id="cb20-11" title="11">  <span class="co">// Only include realistic times (0 to 168 hours = 1 week)</span></a>
<a class="sourceLine" id="cb20-12" title="12">  <span class="cf">if</span> (processingHours <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> processingHours <span class="op">&lt;=</span> <span class="dv">168</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-13" title="13">    <span class="va">processingTimes</span>.<span class="at">push</span>(processingHours)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-14" title="14">  <span class="op">}</span></a>
<a class="sourceLine" id="cb20-15" title="15"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-16" title="16"></a>
<a class="sourceLine" id="cb20-17" title="17"><span class="co">// Sort for percentile calculations</span></a>
<a class="sourceLine" id="cb20-18" title="18"><span class="va">processingTimes</span>.<span class="at">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a <span class="op">-</span> b)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-19" title="19"></a>
<a class="sourceLine" id="cb20-20" title="20"><span class="co">// Calculate median (50th percentile)</span></a>
<a class="sourceLine" id="cb20-21" title="21"><span class="kw">const</span> median <span class="op">=</span> processingTimes[<span class="va">Math</span>.<span class="at">floor</span>(<span class="va">processingTimes</span>.<span class="at">length</span> / <span class="dv">2</span>)]<span class="op">;</span></a>
<a class="sourceLine" id="cb20-22" title="22"></a>
<a class="sourceLine" id="cb20-23" title="23"><span class="co">// Calculate 90th percentile</span></a>
<a class="sourceLine" id="cb20-24" title="24"><span class="kw">const</span> p90 <span class="op">=</span> processingTimes[<span class="va">Math</span>.<span class="at">floor</span>(<span class="va">processingTimes</span>.<span class="at">length</span> <span class="op">*</span> <span class="fl">0.9</span>)]<span class="op">;</span></a></code></pre></div>
<p><strong>Formula:</strong> <code>(order.updated_at - order.created_at) / 3600 seconds</code></p>
<p><strong>Metrics Reported:</strong> - Median processing time (50th percentile) - 90th percentile processing time (P90) - Sample size (order count)</p>
<p><strong>Time Filters:</strong> Only includes orders with 0-168 hour processing time (excludes outliers)</p>
<p><strong>Data Sources:</strong> - <code>order.created</code> sheet (created_at, updated_at)</p>
<p><strong>Unit:</strong> Hours with 2 decimal places</p>
<p><strong>Quality Thresholds:</strong> - Excellent: Median &lt; 24 hours - Good: Median 24-48 hours - Needs Improvement: Median &gt; 48 hours</p>
<p><strong>Business Significance:</strong> Operational efficiency indicator; faster processing improves customer satisfaction</p>
<hr />
<h3 id="product-performance">20. Product Performance</h3>
<p><strong>Section:</strong> Operations &amp; Logistics Metrics</p>
<p><strong>What it is:</strong> Revenue and order metrics broken down by product.</p>
<p><strong>What it means:</strong> Identifies top-performing products and revenue drivers.</p>
<p><strong>How it’s calculated:</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">const</span> productMetrics <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb21-2" title="2"></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="va">data</span>.<span class="va">products</span>.<span class="at">forEach</span>(product <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="kw">const</span> productId <span class="op">=</span> <span class="va">product</span>.<span class="at">product_id</span><span class="op">;</span></a>
<a class="sourceLine" id="cb21-5" title="5"></a>
<a class="sourceLine" id="cb21-6" title="6">  <span class="co">// Find all orders for this product</span></a>
<a class="sourceLine" id="cb21-7" title="7">  <span class="kw">const</span> productOrders <span class="op">=</span> <span class="va">data</span>.<span class="va">orders</span>.<span class="at">filter</span>(order <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb21-8" title="8">    <span class="va">order</span>.<span class="at">product_id</span> <span class="op">===</span> productId</a>
<a class="sourceLine" id="cb21-9" title="9">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb21-10" title="10"></a>
<a class="sourceLine" id="cb21-11" title="11">  <span class="co">// Find all subscriptions for this product</span></a>
<a class="sourceLine" id="cb21-12" title="12">  <span class="kw">const</span> productSubscriptions <span class="op">=</span> <span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">filter</span>(sub <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb21-13" title="13">    <span class="va">sub</span>.<span class="at">ProductID</span> <span class="op">===</span> productId</a>
<a class="sourceLine" id="cb21-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb21-15" title="15"></a>
<a class="sourceLine" id="cb21-16" title="16">  <span class="co">// Calculate revenue (sum payments for product orders)</span></a>
<a class="sourceLine" id="cb21-17" title="17">  <span class="kw">const</span> revenue <span class="op">=</span> <span class="va">productOrders</span>.<span class="at">reduce</span>((sum<span class="op">,</span> order) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb21-18" title="18">    <span class="kw">const</span> payment <span class="op">=</span> <span class="va">data</span>.<span class="va">payments</span>.<span class="at">find</span>(p <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb21-19" title="19">      <span class="va">p</span>.<span class="at">order_number</span> <span class="op">===</span> <span class="va">order</span>.<span class="at">order_id</span></a>
<a class="sourceLine" id="cb21-20" title="20">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb21-21" title="21">    <span class="cf">return</span> sum <span class="op">+</span> (payment <span class="op">?</span> <span class="at">parseFloat</span>(<span class="va">payment</span>.<span class="at">amount</span>) <span class="op">||</span> <span class="dv">0</span> : <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-22" title="22">  <span class="op">},</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-23" title="23"></a>
<a class="sourceLine" id="cb21-24" title="24">  <span class="co">// Count unique customers</span></a>
<a class="sourceLine" id="cb21-25" title="25">  <span class="kw">const</span> uniqueCustomers <span class="op">=</span> <span class="kw">new</span> <span class="at">Set</span>(</a>
<a class="sourceLine" id="cb21-26" title="26">    <span class="va">productOrders</span>.<span class="at">map</span>(o <span class="kw">=&gt;</span> <span class="va">o</span>.<span class="at">customer_id</span>)</a>
<a class="sourceLine" id="cb21-27" title="27">  ).<span class="at">size</span><span class="op">;</span></a>
<a class="sourceLine" id="cb21-28" title="28"></a>
<a class="sourceLine" id="cb21-29" title="29">  productMetrics[productId] <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb21-30" title="30">    <span class="dt">name</span><span class="op">:</span> <span class="va">product</span>.<span class="at">name</span> <span class="op">||</span> productId<span class="op">,</span></a>
<a class="sourceLine" id="cb21-31" title="31">    <span class="dt">totalOrders</span><span class="op">:</span> <span class="va">productOrders</span>.<span class="at">length</span><span class="op">,</span></a>
<a class="sourceLine" id="cb21-32" title="32">    <span class="dt">activeSubscriptions</span><span class="op">:</span> <span class="va">productSubscriptions</span>.<span class="at">filter</span>(s <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb21-33" title="33">      <span class="va">s</span>.<span class="at">Status</span> <span class="op">===</span> <span class="st">&#39;active&#39;</span></a>
<a class="sourceLine" id="cb21-34" title="34">    ).<span class="at">length</span><span class="op">,</span></a>
<a class="sourceLine" id="cb21-35" title="35">    <span class="dt">revenue</span><span class="op">:</span> <span class="va">Math</span>.<span class="at">round</span>(revenue <span class="op">*</span> <span class="dv">100</span>) / <span class="dv">100</span><span class="op">,</span></a>
<a class="sourceLine" id="cb21-36" title="36">    <span class="dt">uniqueCustomers</span><span class="op">:</span> uniqueCustomers</a>
<a class="sourceLine" id="cb21-37" title="37">  <span class="op">};</span></a>
<a class="sourceLine" id="cb21-38" title="38"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-39" title="39"></a>
<a class="sourceLine" id="cb21-40" title="40"><span class="co">// Sort by revenue and take top 5</span></a>
<a class="sourceLine" id="cb21-41" title="41"><span class="kw">const</span> topProducts <span class="op">=</span> <span class="va">Object</span>.<span class="at">values</span>(productMetrics)</a>
<a class="sourceLine" id="cb21-42" title="42">  .<span class="at">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="va">b</span>.<span class="at">revenue</span> <span class="op">-</span> <span class="va">a</span>.<span class="at">revenue</span>)</a>
<a class="sourceLine" id="cb21-43" title="43">  .<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Metrics Per Product:</strong> - Product name - Total order count - Active subscription count - Total revenue (USD) - Unique customer count</p>
<p><strong>Data Sources:</strong> - <code>products</code> sheet (product_id, name) - <code>order.created</code> sheet (order_id, product_id, customer_id) - <code>subscription.active</code> sheet (ProductID, Status) - <code>payment_succesful</code> sheet (order_number, amount)</p>
<p><strong>Join Logic:</strong> - <code>order.product_id = product.product_id</code> - <code>subscription.ProductID = product.product_id</code> - <code>payment.order_number = order.order_id</code></p>
<p><strong>Display:</strong> Top 5 products by revenue</p>
<p><strong>Quality Indicator:</strong> ‘good’ when products exist</p>
<p><strong>Business Significance:</strong> Product strategy; identifies which offerings drive revenue</p>
<hr />
<h2 id="data-quality-indicators">Data Quality Indicators</h2>
<h3 id="quality-assessment">Quality Assessment</h3>
<p>The dashboard assesses data quality and displays it in metadata:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">function</span> <span class="at">assessDataQuality</span>(data) <span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="kw">const</span> quality <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-3" title="3">    <span class="dt">customers</span><span class="op">:</span> <span class="va">data</span>.<span class="va">customers</span>.<span class="at">length</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-4" title="4">    <span class="dt">orders</span><span class="op">:</span> <span class="va">data</span>.<span class="va">orders</span>.<span class="at">length</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-5" title="5">    <span class="dt">payments</span><span class="op">:</span> <span class="va">data</span>.<span class="va">payments</span>.<span class="at">length</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-6" title="6">    <span class="dt">subscriptions</span><span class="op">:</span> <span class="va">data</span>.<span class="va">subscriptions</span>.<span class="at">length</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-7" title="7">    <span class="dt">overall</span><span class="op">:</span> <span class="st">&#39;good&#39;</span></a>
<a class="sourceLine" id="cb22-8" title="8">  <span class="op">};</span></a>
<a class="sourceLine" id="cb22-9" title="9"></a>
<a class="sourceLine" id="cb22-10" title="10">  <span class="cf">if</span> (<span class="va">quality</span>.<span class="at">customers</span> <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">||</span> <span class="va">quality</span>.<span class="at">orders</span> <span class="op">&lt;</span> <span class="dv">10</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb22-11" title="11">    <span class="va">quality</span>.<span class="at">overall</span> <span class="op">=</span> <span class="st">&#39;low&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb22-13" title="13"></a>
<a class="sourceLine" id="cb22-14" title="14">  <span class="cf">return</span> quality<span class="op">;</span></a>
<a class="sourceLine" id="cb22-15" title="15"><span class="op">}</span></a></code></pre></div>
<p><strong>Thresholds:</strong> - Overall = ‘low’ if customers &lt; 10 OR orders &lt; 10 - Overall = ‘good’ otherwise</p>
<p><strong>Displayed In:</strong> Metadata section at bottom of dashboard</p>
<hr />
<h3 id="quality-levels-by-metric">Quality Levels by Metric</h3>
<p>Each KPI includes a quality indicator:</p>
<ul>
<li><strong>‘excellent’</strong>: Metric exceeds target thresholds</li>
<li><strong>‘good’</strong>: Metric meets baseline requirements</li>
<li><strong>‘needs_improvement’</strong>: Metric below targets but calculable</li>
<li><strong>‘low’</strong>: Insufficient data for reliable calculation</li>
<li><strong>‘error’</strong>: Calculation failed</li>
<li><strong>‘no_data’</strong>: No data available</li>
</ul>
<hr />
<h2 id="time-period-calculations">Time Period Calculations</h2>
<h3 id="date-range-determination">Date Range Determination</h3>
<p><strong>Monthly (default):</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1">startDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">now</span>.<span class="at">getFullYear</span>()<span class="op">,</span> <span class="va">now</span>.<span class="at">getMonth</span>()<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// First day of current month</span></a>
<a class="sourceLine" id="cb23-2" title="2">endDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(now)<span class="op">;</span> <span class="co">// Today</span></a></code></pre></div>
<p><strong>Weekly:</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1">startDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(now)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="va">startDate</span>.<span class="at">setDate</span>(<span class="va">now</span>.<span class="at">getDate</span>() <span class="op">-</span> <span class="va">now</span>.<span class="at">getDay</span>())<span class="op">;</span> <span class="co">// Start of current week (Sunday)</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="va">startDate</span>.<span class="at">setHours</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-4" title="4">endDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(now)<span class="op">;</span></a></code></pre></div>
<p><strong>Quarterly:</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">const</span> quarterStart <span class="op">=</span> <span class="va">Math</span>.<span class="at">floor</span>(<span class="va">now</span>.<span class="at">getMonth</span>() / <span class="dv">3</span>) <span class="op">*</span> <span class="dv">3</span><span class="op">;</span> <span class="co">// 0, 3, 6, or 9</span></a>
<a class="sourceLine" id="cb25-2" title="2">startDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="va">now</span>.<span class="at">getFullYear</span>()<span class="op">,</span> quarterStart<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb25-3" title="3">endDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(now)<span class="op">;</span></a></code></pre></div>
<p><strong>All Time:</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1">startDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="st">&#39;2020-01-01&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb26-2" title="2">endDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(now)<span class="op">;</span></a></code></pre></div>
<p><strong>Custom:</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1"><span class="co">// User provides dates via date picker</span></a>
<a class="sourceLine" id="cb27-2" title="2">startDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(startDateISO)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-3" title="3">endDate <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(endDateISO)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="va">endDate</span>.<span class="at">setHours</span>(<span class="dv">23</span><span class="op">,</span> <span class="dv">59</span><span class="op">,</span> <span class="dv">59</span><span class="op">,</span> <span class="dv">999</span>)<span class="op">;</span> <span class="co">// Include full end day</span></a></code></pre></div>
<hr />
<h2 id="data-sources-reference">Data Sources Reference</h2>
<h3 id="spreadsheet-structure">Spreadsheet Structure</h3>
<p><strong>Spreadsheet ID:</strong> <code>1PaCOgNJmKSb2VsJjCMjWpCG-gwrO7uVkuTAFUdrV-_o</code></p>
<h3 id="sheet-names-and-key-fields">Sheet Names and Key Fields</h3>
<p><strong>customers:</strong> - customer_id - created_at - email</p>
<p><strong>order.created:</strong> - order_id - customer_id - product_id - total_amount - created_at - updated_at - source (‘checkout’ or ‘renewal’) - shipping_address_id</p>
<p><strong>payment_succesful:</strong> - order_number (joins to order.order_id) - amount - datetime</p>
<p><strong>refund.created:</strong> - order_id - amount - datetime</p>
<p><strong>products:</strong> - product_id - name - renewal_price - renewal_cycle_duration (days) - sale_cycle_duration (number of prepaid orders)</p>
<p><strong>subscription.active:</strong> - CustomerID - ProductID - Status - Datetime Created</p>
<p><strong>subscription.cancelled:</strong> - customer_id - last_updated</p>
<p><strong>subscription.paused:</strong> - customer_id - last_updated</p>
<p><strong>addresses:</strong> - address_id - province_code (US state)</p>
<hr />
<h2 id="calculation-performance">Calculation Performance</h2>
<h3 id="caching-strategy">Caching Strategy</h3>
<ul>
<li>Cache duration: 6 minutes (360 seconds)</li>
<li>Cache key format: <code>enhanced_kpis_{timePeriod}_{startTime}_{endTime}</code></li>
<li>Cache service: Google Apps Script CacheService</li>
</ul>
<h3 id="calculation-order">Calculation Order</h3>
<ol type="1">
<li>Load all data from sheets</li>
<li>Calculate CLV metrics (includes ARPU, Churn, Predictive CLV)</li>
<li>Calculate Renewal Rate</li>
<li>Calculate time-dependent metrics with date filtering</li>
<li>Assess data quality</li>
<li>Cache results</li>
<li>Return JSON to frontend</li>
</ol>
<hr />
<h2 id="metadata-display">Metadata Display</h2>
<p>At the bottom of the dashboard, the following metadata is shown:</p>
<ul>
<li><strong>Last Updated:</strong> Timestamp of KPI calculation</li>
<li><strong>Time Period:</strong> Selected time period (monthly, weekly, etc.)</li>
<li><strong>Data Points:</strong> Count of subscriptions, customers, and orders used in calculations</li>
</ul>
<hr />
<h2 id="dashboard-sections">Dashboard Sections</h2>
<p>The KPIs are organized into 5 main sections:</p>
<ol type="1">
<li><strong>Growth &amp; Revenue Metrics</strong> (📈)
<ul>
<li>New Patient Enrollments</li>
<li>Realized CLV (All)</li>
<li>Realized CLV (Mature)</li>
<li>Mature Customer Ratio</li>
<li>MRR</li>
<li>ARPU</li>
<li>Predictive CLV</li>
</ul></li>
<li><strong>Operations &amp; Logistics Metrics</strong> (⚙️)
<ul>
<li>Purchase → Awaiting Script time</li>
<li>Awaiting Script → Awaiting Shipment time</li>
<li>Awaiting Shipment → Shipped time</li>
<li>Purchase → Shipped total time</li>
<li>Geographic Reach</li>
<li>Order Processing Efficiency</li>
<li>Product Performance</li>
</ul></li>
<li><strong>Clinical &amp; Patient Success Metrics</strong> (🏥)
<ul>
<li>Active Patients</li>
<li>Renewal Rate</li>
<li>Medication Adherence Rate</li>
<li>Churn Rate</li>
</ul></li>
<li><strong>Financial Risk Metrics</strong> (💰)
<ul>
<li>Net Revenue After Refunds</li>
<li>Payment Success Rate</li>
</ul></li>
<li><strong>Order Flow &amp; Stage Analysis</strong> (🔄)
<ul>
<li>Order stage transition times</li>
</ul></li>
</ol>
<hr />
<h2 id="pending-kpis-placeholders">Pending KPIs (Placeholders)</h2>
<p>The following KPIs are displayed as placeholders awaiting data integration:</p>
<ol type="1">
<li><strong>Customer Acquisition Cost (CAC)</strong>
<ul>
<li>Requires: Marketing cost data integration</li>
</ul></li>
<li><strong>Cancelled Order/Refund Rate</strong>
<ul>
<li>Requires: Enhanced Stripe tracking</li>
</ul></li>
<li><strong>Shipping SLA Compliance</strong>
<ul>
<li>Requires: Shipping provider API integration</li>
</ul></li>
<li><strong>Support Ticket Metrics</strong>
<ul>
<li>Requires: Support system integration</li>
</ul></li>
<li><strong>Average Weight Loss</strong>
<ul>
<li>Requires: Patient outcome data extraction</li>
</ul></li>
<li><strong>Lead-to-Consult Conversion</strong>
<ul>
<li>Requires: Marketing funnel data integration</li>
</ul></li>
</ol>
<hr />
<h2 id="technical-notes">Technical Notes</h2>
<h3 id="google-apps-script-compatibility">Google Apps Script Compatibility</h3>
<ul>
<li>All Date objects converted to ISO strings for transmission</li>
<li>Uses <code>google.script.run</code> for client-server communication</li>
<li>HIPAA compliance checks on every request</li>
<li>Audit logging for all dashboard access</li>
</ul>
<h3 id="error-handling">Error Handling</h3>
<ul>
<li>Multiple fallback calculation methods</li>
<li>Minimal KPI structure returned on critical errors</li>
<li>Detailed error logging to console</li>
<li>User-friendly error messages displayed</li>
</ul>
<h3 id="browser-compatibility">Browser Compatibility</h3>
<ul>
<li>Supports all modern browsers</li>
<li>Mobile-responsive design</li>
<li>Works with Google Workspace authentication</li>
</ul>
<hr />
<h2 id="version-history">Version History</h2>
<p><strong>Version 1.0</strong> (2025-10-22) - Initial comprehensive documentation - All 20+ KPIs documented with formulas - Data source mapping complete - Quality indicators defined</p>
<hr />
<h2 id="contact-support">Contact &amp; Support</h2>
<p>For questions about KPI calculations or dashboard access: - Check Google Apps Script logs for detailed calculation traces - Review data quality indicators in dashboard metadata - Contact system administrator for data source issues</p>
<hr />
<p><strong>End of Document</strong></p>
</body>
</html>
